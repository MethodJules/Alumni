function drupalchatCreateCookie(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"}function drupalchatReadCookie(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null}function drupalchatEraseCookie(e){drupalchatCreateCookie(e,"",-1)}function drupalchatCheckUrl(e,t){(function(n){if(n.browser.msie&&window.XDomainRequest){var r=new XDomainRequest;r.open("get",e);r.onload=function(){n("body").append("<style>"+r.responseText+"</style>");drupalchatLoad(t)};r.onerror=function(e){drupalchatForceLoad()};r.send()}else{var i=new XMLHttpRequest;i.open("GET",e,true);i.send();i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){n("body").append("<style>"+i.responseText+"</style>");drupalchatLoad(t)}else if(i.readyState==4&&i.status!=200){drupalchatForceLoad()}}}})(jQuery)}function drupalchatForceLoad(){(function(e){e.post(Drupal.settings.drupalchat.exurl,function(e){drupalchatLoad(e);if(Drupal.settings.drupalchat.chat_type==="2"){drupalchatCreateCookie("iflychat_key",e.key,30);drupalchatCreateCookie("iflychat_css",e.css,30);drupalchatCreateCookie("iflychat_time",(new Date).getTime(),30)}})})(jQuery)}function drupalchatLoad(e){if(e&&typeof e.css!="undefined"&&typeof e.key!="undefined"){Drupal.settings.drupalchat.session_key=e.key;if(typeof e.name!=="undefined"){Drupal.settings.drupalchat.username=e.name}if(typeof e.uid!=="undefined"){Drupal.settings.drupalchat.uid=e.uid}if(typeof e.up!=="undefined"){Drupal.settings.drupalchat.up=e.up}if(typeof e.upl!=="undefined"){Drupal.settings.drupalchat.upl=e.upl}if(Drupal.settings.drupalchat.chat_type==="2"){if(typeof e.cache==="undefined"){LazyLoad.css(["//cdn.iflychat.com/css/iflychat-"+Drupal.settings.drupalchat.theme+".css",Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/i/"+e.css+"/settings/no.cache.css"],function(){LazyLoad.js([Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/h/"+e.css+"/settings/no.cache.js","//cdn.iflychat.com/js/iflychat.min.js"],function(){})})}else{}}else{LazyLoad.css(Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/i/"+e.css+"/s/"+(Drupal.settings.drupalchat.admin=="1"?"a/":"")+"cache.css",function(){LazyLoad.js([Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/j/cache.js",Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/h/"+e.css+"/s"+(Drupal.settings.drupalchat.admin=="1"?"/a":"")+"/cache.js"],function(){})})}}}LazyLoad=function(e){function t(t,n){var r=e.createElement(t),i;for(i in n)n.hasOwnProperty(i)&&r.setAttribute(i,n[i]);return r}function n(e){var t=f[e],n,r;if(t)n=t.callback,r=t.urls,r.shift(),l=0,r.length||(n&&n.call(t.context,t.obj),f[e]=null,c[e].length&&i(e))}function r(){var t=navigator.userAgent;u={async:e.createElement("script").async===!0};(u.webkit=/AppleWebKit\//.test(t))||(u.ie=/MSIE/.test(t))||(u.opera=/Opera/.test(t))||(u.gecko=/Gecko\//.test(t))||(u.unknown=!0)}function i(i,l,h,d,v){var g=function(){n(i)},y=i==="css",b=[],E,S,x,T;u||r();if(l)if(l=typeof l==="string"?[l]:l.concat(),y||u.async||u.gecko||u.opera)c[i].push({urls:l,callback:h,obj:d,context:v});else{E=0;for(S=l.length;E<S;++E)c[i].push({urls:[l[E]],callback:E===S-1?h:null,obj:d,context:v})}if(!f[i]&&(T=f[i]=c[i].shift())){a||(a=e.head||e.getElementsByTagName("head")[0]);l=T.urls;E=0;for(S=l.length;E<S;++E)h=l[E],y?x=u.gecko?t("style"):t("link",{href:h,rel:"stylesheet"}):(x=t("script",{src:h}),x.async=!1),x.className="lazyload",x.setAttribute("charset","utf-8"),u.ie&&!y?x.onreadystatechange=function(){if(/loaded|complete/.test(x.readyState))x.onreadystatechange=null,g()}:y&&(u.gecko||u.webkit)?u.webkit?(T.urls[E]=x.href,o()):(x.innerHTML='@import "'+h+'";',s(x)):x.onload=x.onerror=g,b.push(x);E=0;for(S=b.length;E<S;++E)a.appendChild(b[E])}}function s(e){var t;try{t=!!e.sheet.cssRules}catch(r){l+=1;l<200?setTimeout(function(){s(e)},50):t&&n("css");return}n("css")}function o(){var e=f.css,t;if(e){for(t=h.length;--t>=0;)if(h[t].href===e.urls[0]){n("css");break}l+=1;e&&(l<200?setTimeout(o,50):n("css"))}}var u,a,f={},l=0,c={css:[],js:[]},h=e.styleSheets;return{css:function(e,t,n,r){i("css",e,t,n,r)},js:function(e,t,n,r){i("js",e,t,n,r)}}}(this.document);(function(e){e(document).ready(function(){if(false&&drupalchatReadCookie("iflychat_key")&&drupalchatReadCookie("iflychat_css")&&Drupal.settings.drupalchat.chat_type==="2"){var e={key:drupalchatReadCookie("iflychat_key"),css:drupalchatReadCookie("iflychat_css"),cache:"1"};drupalchatCheckUrl(Drupal.settings.drupalchat.external_a_host+":"+Drupal.settings.drupalchat.external_a_port+"/i/"+drupalchatReadCookie("iflychat_css")+"/cache.css",e)}else{drupalchatForceLoad()}})})(jQuery)
